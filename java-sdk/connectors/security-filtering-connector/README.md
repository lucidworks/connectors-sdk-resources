# Security filtering Connector

## Connector Description

- This connector generates a configurable number of content collection documents and a static ACL hierarchy.
- The ACL Documents fetcher is implemented in `SecurityFilteringAccessControlFetcher` class.
- The documents indexed by the access control fetcher are stored in the collection: `{DATASOURCE_ID}_access_control_hierarchy` where the `DATASOURCE_ID` is the id of the configuration.

### Access Control Fetcher behavior

Access control hierarchy used here is static and structured in the following way:

![ACL hierarchy](/docs/acl_hierarchy.png)

Every content document consists of fields (your regular data) and permissions (ACL information).

![Document structure](/docs/document_structure.png)

Every permission is emitted as a separate ACL document which connects content documents to access control hierarchy. For this trivial example this is not required, and you could just include the principal name (user/group) in the content document ACL field.

![ACL final hierarchy](/docs/acl_final_hierarchy.png)


## Quick start

1. Clone the repo:
```
git clone https://github.com/lucidworks/connectors-sdk-resources.git
cd connectors-sdk-resources/java-sdk/connectors/
./gradlew assemblePlugins
```

2. This produces one zip file, named `security-filtering-connector.zip`, located in the `security-filtering-connector/build/plugins` directory.
This artifact is now ready to be uploaded directly to Fusion as a connector plugin.

3. See the following [instructions](../README.md) on how to build, deploy, and run the plugin.


## Connector properties

### Main properties

|Property Name| Property description|
|---|---|
| Nested Groups | The number of nested groups to be generated by the access control fetch |

### Security trimming properties

|Property Name| Property description|
|---|---|
| Enable security trimming | When enable, the access control fetcher will be executed |
| ACL collection name | The name of the collection where the documents indexed by access control fetcher will be indexed |

### Content generator properties

|Property Name| Property description|
|---|---|
| Total | The total number of documents to generate |
| Minimum number of sentences | The minimum number of sentences to generate per document, the random generator will use this value as lower bound to calculate a random number of sentences|
| maximum number of sentences | The maximum number of sentences to generate per document, the random generator will use this value as upper bound to calculate a random number of sentences|

## Security trimming stage (Query time)

After indexing documents in the content and access control collections, we can run a search query to filter the results based on a username.
First, we need to add the `Security Trimming` query stage to the query pipeline and configure it.

Check the access control collection to review which users and groups were indexed.
